import random
import re
import tweepy
import time
import sys
reload(sys)
sys.setdefaultencoding('utf-8')
from botomatic import TBot

class TributeBot(TBot):
    debug_mode = False

    def __init__(self):
        handle = "TributeBot"
        super(TributeBot, self).__init__(handle)

    def run(self):
	query="god OR gods OR goddess OR goddesses"
	#query="scruffles"
	print self.api.rate_limit_status()
	count = 0
	p = re.compile(r".*([^\s]+)s? (for|unto) the \1 (god|goddess)", re.IGNORECASE)
        for msgs in tweepy.Cursor(self.api.search, q=query, count=100).pages():
          print "---" + str(count)
	  for msg in msgs:
            count = count + 1
            t = msg.text
            if count % 100 == 0:
	        print "count: " + str(count)
                time.sleep(10)

            print msg.user.screen_name.encode('utf-8') + u": " + msg.text.encode('utf-8')
            m = p.match(msg.text)
            if m is None:
                continue
            print "*************** " + str(msg.id)
            if re.search("scruffle", msg.text) is None:
		    self.api.retweet(msg.id)

        self.wrap_up()



if __name__ == '__main__':
    m = TributeBot()
